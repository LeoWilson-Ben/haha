"""
24 节气：根据公历日期计算当前所处节气（近似，适用于常见年份）。
"""
from datetime import date

# 24 节气日期 (月, 日) 近似值，每年略有浮动
_SOLAR_TERMS = [
    (1, 5, "小寒"),
    (1, 20, "大寒"),
    (2, 3, "立春"),
    (2, 18, "雨水"),
    (3, 5, "惊蛰"),
    (3, 20, "春分"),
    (4, 4, "清明"),
    (4, 20, "谷雨"),
    (5, 5, "立夏"),
    (5, 21, "小满"),
    (6, 5, "芒种"),
    (6, 21, "夏至"),
    (7, 6, "小暑"),
    (7, 22, "大暑"),
    (8, 7, "立秋"),
    (8, 23, "处暑"),
    (9, 7, "白露"),
    (9, 22, "秋分"),
    (10, 8, "寒露"),
    (10, 23, "霜降"),
    (11, 7, "立冬"),
    (11, 22, "小雪"),
    (12, 7, "大雪"),
    (12, 21, "冬至"),
]


def get_solar_term(d: date) -> str:
    """
    根据日期返回当前所处节气名称。
    近似计算（每年变化约 ±1 天）。
    """
    def _ord(m: int, day: int) -> int:
        return m * 32 + day

    target = _ord(d.month, d.day)
    # 1 月上旬（小寒之前）为冬至
    if target < _ord(1, 5):
        return "冬至"
    result = _SOLAR_TERMS[0][2]
    for m, day, name in _SOLAR_TERMS:
        if _ord(m, day) <= target:
            result = name
    return result
